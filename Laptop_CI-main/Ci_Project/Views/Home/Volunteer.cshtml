@{
    ViewData["Title"] = "Volunteering Mission Page";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@model GeneralViewModel

@using System.Security.Claims;
@{
    var identity = User.Identity as ClaimsIdentity;
    var name = identity?.FindFirst(ClaimTypes.Name)?.Value;
    var surname = identity?.FindFirst(ClaimTypes.Surname)?.Value;
    var Email = identity?.FindFirst(ClaimTypes.Email)?.Value;
    var uid = identity?.FindFirst(ClaimTypes.Sid)?.Value;
}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="stylesheet" href="~/css/Volunteer.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <title>Volunteer</title>
</head>

<body>

    @*<partial name="_navbar.cshtml"></partial>*@
    <partial name="_AllNavbar" />
    <div class="container">
        <div class="d-flex mt-5">
            <div class="row">
                <div class="col-lg-6 col-md-12 col-sm-12">
                    <div class="container h-100">
                        <div class="" style="height:80%">
                            <!-- Full-width images with number text -->
                            <div class="mySlides  h-100">
                                <img src="~/images/Assets/CSR-initiative-stands-for-Coffee--and-Farmer-Equity-4.png"
                                     style="width:100%" class="h-100">
                            </div>
                            <div class="mySlides h-100">
                                <img src="~/images/Assets/Grow-Trees-On-the-path-to-environment-sustainability.png"
                                     style="width:100%" class="h-100">
                            </div>
                            <div class="mySlides h-100">
                                <img src="~/images/Assets/Grow-Trees-On-the-path-to-environment-sustainability.png"
                                     style="width:100%" class="h-100">
                            </div>
                            <div class="mySlides h-100">
                                <img src="~/images/Assets/img33.png" style="width:100%" class="h-100">
                            </div>
                            <div class="mySlides h-100">
                                <img src="~/images/Assets/CSR-initiative-stands-for-Coffee--and-Farmer-Equity-4.png"
                                     style="width:100%" class="h-100">
                            </div>
                            <div class="mySlides h-100">
                                <img src="~/images/Assets/img33.png" style="width:100%" class="h-100">
                            </div>
                            <!-- Next and previous buttons -->
                            <a class="prev" onclick="plusSlides(-1)">&#10094;</a>
                            <a class="next" onclick="plusSlides(1)">&#10095;</a>
                        </div>
                        <!-- Thumbnail images -->
                        <div class="row mt-2" style="height:15%">
                            <div class="col-lg-3 col-md-3 col-sm-3 col-3">
                                <img class="demo cursor"
                                     src="~/images/Assets/CSR-initiative-stands-for-Coffee--and-Farmer-Equity-4.png"
                                     style="width:100%" onclick="currentSlide(1)" alt="The Woods" class="h-100">
                            </div>
                            <div class="col-lg-3 col-md-3 col-sm-3 col-3">
                                <img class="demo cursor" src="~/images/Assets/img3.png" style="width:100%"
                                     onclick="currentSlide(2)" alt="Cinque Terre" class="h-100">
                            </div>
                            <div class="col-lg-3 col-md-3 col-sm-3 col-3">
                                <img class="demo cursor"
                                     src="~/images/Assets/Grow-Trees-On-the-path-to-environment-sustainability-5.png"
                                     style="width:100%" onclick="currentSlide(3)" alt="Mountains and fjords" class="h-100">
                            </div>
                            <div class="col-lg-3 col-md-3 col-sm-3 col-3">
                                <img class="demo cursor" src="~/images/Assets/img33.png" style="width:100%"
                                     onclick="currentSlide(4)" alt="Northern Lights" class="h-100">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 col-md-12 col-sm-12">
                    <h3>@Model.mission_details.Title</h3>
                    <p>@Model.mission_details.Description</p>
                     
                    <div class="border-top mt-4">
                        @if (Model.mission_details.MissionType == "Goal")
                        {
                            <div>
                                <div class="d-flex justify-content-center mt-4">
                                    <div class="star">
                                        <p class="text-center"
                                       style="border: 1px solid gray;border-radius:20px;padding:3px 15px 3px 15px ;">
                                            Plant 10,000 Trees
                                        </p>
                                    </div>
                                </div>
                            </div>
                        }
                        else
                        {
                            <div>
                                <div class="d-flex justify-content-center mt-4">
                                    <div class="star">
                                        <p class="text-center" style="border: 1px solid gray;border-radius:20px;padding:0px 15px 0px 15px ;">
                                            From
                                            @Model.mission_details.StartDate.ToShortDateString() until
                                            @Model.mission_details.EndDate.ToShortDateString()
                                        </p>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                    <div class="d-flex justify-content-center">
                        <div class="col-lg-4 col-sm-4">
                            <div class="row">
                                <div class="col-lg-2 col-sm-2 col-2">
                                    <img src="~/images/Assets/Seats-left.png" alt="">
                                </div>
                                <div class="col-lg-9 col-sm-10">
                                    <p>@Model.mission_details.Availability <br> Seats Left</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-5 col-sm-5 col-5">
                            <div class="d-flex">
                                <div class="col-lg-2 col-sm-2 ">
                                    <img src="~/images/Assets/Achieved.png" alt="">
                                </div>
                                <div class="col-lg-10 col-sm-10">
                                    @if (Model.mission_details.MissionType == "Goal")
                                    {
                                        @foreach (var goal in Model.goal)
                                        {

                                            @if (@Model.mission_details.MissionId == goal.MissionId)
                                            {
                                                <div class="progress">
                                                @{int percentComplete = (int)Math.Round((double)(100 * @goal.GoalValue) / @goal.Aimed);
                                                }
                                                <div class="progress-bar" role="progressbar" style="width: @percentComplete% ;background-color: #F88634;color:#f88634" aria-valuenow=@goal.GoalValue
                                                aria-valuemin="0" aria-valuemax="100"></div>
                                                </div>  
                                                <p> @goal.GoalValue  Achieved</p>

                                            }
                                            else
                                            {
                                                <div class="progress">
                                                    <div class="progress-bar" role="progressbar" style="width: 75%;background-color: #F88634 !important;" aria-valuenow="75"
													    aria-valuemin="0" aria-valuemax="100">
                                                    </div>
                                                </div>
                                                <p class="mb-0">8000 achieved</p>
                                                
                                            }
                                            break;
                                        }
                                    }
                                    else
                                    {
                                        <div class=" pt-3">
                                            <div class="d-flex justify-content-center mt-4">
                                                <div class="star">
                                                    <p class="text-center">
                                                        From
                                                        @Model.mission_details.StartDate.ToShortDateString() until
                                                        @Model.mission_details.EndDate.ToShortDateString()
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    }

                                </div>

                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="row mt-4">
                        <div class="col-lg-6 col-12 text-center">
                            @*add to fav*@
                            @{
                                var currentDates = DateTime.Now;
                                if (currentDates < @Model.mission_details.EndDate)
                                {
                                    @if (Model.FavoriteMissions.Where(x => x.UserId == Convert.ToInt32(uid) &&
                                    x.MissionId == Model.mission_details.MissionId).Count() == 1)
                                    {
                                        <div class="btn">
                                            <a id="favbtn" onclick="fav(@Model.mission_details.MissionId)" class="btn favorite added ms-4" style="background:none;border:2px solid gray;border-radius:30px;padding:5px 30px 5px 30px">
                                                <i class="bi bi-heart-fill text-danger pe-2"></i>Remove From
                                                favorite
                                            </a>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="btn">
                                            <a id="favbtn" onclick="fav(@Model.mission_details.MissionId)" class="btn favorite added ms-4" style="background:none;border:2px solid gray;border-radius:30px;padding:5px 30px 5px 30px">
                                                <i class="bi bi-heart pe-2"></i>Add to Favorite
                                            </a>
                                        </div>
                                    }
                                }
                                else
                                {
                                <button class="favorite">
                                    <img src="~/Assets/heart1.png" alt="">Add To
                                    Favorite
                                </button>
                                }
                            }
                            
                            
                        </div>
                        <div class="col-lg-6 col-11 text-center">
                            @*recommended*@
                            @{
                                var currentDate2 = DateTime.Now;
                                if (currentDate2 < @Model.mission_details.EndDate)
                                {
                                     <div class="btn">
                                        <button id="show" type="button" class="ms-4 show-dialog" style="background:none;border:2px solid gray;border-radius:30px;padding:5px 10px 5px 10px">
                                            <img src="~/Assets/add1.png" />Recommended To Co-Worker
                                        </button>
                                        <dialog class="myDialog">
                                            <ul class="float-left">
                                                @foreach (var n in Model.Users)
                                                {
                                                    if (n.Email != Email)
                                                    {
                                                        <li class="form-check" style="margin-left:-50%">
                                                            <img src="@Model.Users.Where(x=>x.UserId == n.UserId).Select(x=>x.Avatar).FirstOrDefault()" alt=""
                                                     style="height:15%;width:15%;">
                                                            <input type="checkbox" value="@n.UserId" id="check">
                                                            <label class="form-check-label" for="to">
                                                                <p>@n.FirstName  @n.LastName</p>
                                                            </label>
                                                        </li>
                                                    }
                                                }
                                            </ul>
                                            <button class="form-control btn btn-outline-primary m-2" onclick="recommend(@Model.mission_details.MissionId)">Send an email</button>
                                            <button class="form-control btn btn-outline-danger m-2 hide-dialog" id="show-dialog">Close</button>
                                        </dialog>
                                    </div>
                                }
                                else
                                {
                                <button class="Recommend ms-4">
                                    <img src="~/Assets/add1.png" alt="">Recommend to
                                    co-worker
                                </button>
                                }
                            }
                            
                            

                        </div>
                    </div>
                    @{
                        var currentDate3 = DateTime.Now;
                        if (currentDate3 < @Model.mission_details.EndDate)
                        {
                             <div class="border-top mt-4">
                                <div>

                                    <div class="d-flex border-top position-relative justify-content-center">
                                        <div class="" id="rating" style="transform: translateY(-15px); background-color:white" onmouseout="CRateSelected()">
                                            <img class="rating-star" id="span1" onmouseout='CRateOut(1)' onmouseover='CRateOver(1)' onclick='CRateClick(1)' src="~/Assets/star.png" alt="">
                                            <img class="rating-star" id="span2" onmouseout='CRateOut(2)' onmouseover='CRateOver(2)' onclick='CRateClick(2)' src="~/Assets/star.png" alt="">
                                            <img class="rating-star" id="span3" onmouseout="CRateOut(3)" onmouseover="CRateOver(3)" onclick="CRateClick(3)" src="~/Assets/star.png" alt="">
                                            <img class="rating-star" id="span4" onmouseout="CRateOut(4)" onmouseover="CRateOver(4)" onclick="CRateClick(4)" src="~/Assets/star.png" alt="">
                                            <img class="rating-star" id="span5" onmouseout="CRateOut(5)" onmouseover="CRateOver(5)" onclick="CRateClick(5)" src="~/Assets/star.png" alt="">
                                        </div>
                                        <div>
                                            <input type="hidden" id="lblRating" />
                                        </div>
                                    </div>
                                </div>

                            </div>
                        }
                        else
                        {
                             <div class="border-top mt-4">
                                <div>
                                    <div class="d-flex justify-content-center mt-4">
                                        <div class="star">
                                            <img src="~/Assets/star-empty.png" alt="">
                                            <img src="~/Assets/star-empty.png" alt="">
                                            <img src="~/Assets/star-empty.png" alt="">
                                            <img src="~/Assets/star-empty.png" alt="">
                                            <img src="~/Assets/star-empty.png" alt="">
                                        </div>
                                    </div>
                                </div>
                            </div>

                        }

                    }

                    <div class="d-flex mt-4">
                        <div class="loc ps-1">
                            <img src="~/images/Assets/pin1.png" alt="" class="mb-5 mt-2">
                            <p>City <br>@Model.City.Name</p>
                        </div>
                        <div class="loc ps-1 ms-2">
                            <img src="~/images/Assets/web.png" alt="" class="mb-5 mt-2">
                            <p>Theme <br>@Model.mission_details.ShortDescription</p>
                        </div>
                        <div class="loc ps-1 ms-2">
                            <img src="~/images/Assets/calender.png" alt="" class="mb-4 mt-2">
                            <p>
                                Date <br>From @Model.mission_details.StartDate.ToShortDateString() until  @Model.mission_details.EndDate.ToShortDateString()
                            </p>
                        </div>
                        <div class="loc ps-1 ms-2">
                            <img src="~/images/Assets/add1.png" alt="" class="mb-4 mt-2">
                            <p>Organization <br>@Model.mission_details.OrganizationName</p>
                        </div>
                    </div>

                    <div class="row text-center mt-4">
                        <div class="col-lg-12">
                            @*Apply button*@
                            @{
                                var currentDate4 = DateTime.Now;
                                if (currentDate4 < @Model.mission_details.EndDate)
                                {
                                    var CurrentMissionId = Model.mission_details.MissionId;
                                    var user = @Model.Users.Where(u => u.Email == Email).Select(u => u.UserId).FirstOrDefault();

                                    var alreadyApplied = @Model.missionApplications.Where(x => x.UserId == Convert.ToInt32(user) && x.MissionId == CurrentMissionId).FirstOrDefault();
                                    if (alreadyApplied == null)
                                    {

                                        <a class="btn login buttonColor" onclick="applyMission(@Model.mission_details.MissionId)"
                                        style="width: 30%;border-radius: 20px;border:2px solid #F88634;color: #F88634">
                                            Apply Now &ensp;
                                            <img src="~/images/Assets/right-arrow.png" alt="">
                                        </a>
                                    }
                                    else
                                    {
                                        //var status = Model.missionApplications.Where(x => x.UserId == Convert.ToInt32(uid).Select(x => x.ApprovalStatus).FirstOrDefault();
                                        //if(Model.missionApplications.Where(x => x.UserId == Convert.ToInt32(user)).Select(x => x.ApprovalStatus).FirstOrDefault() ){

                                        //}
                                        <a class="btn login buttonColor" onclick="applyMission(@Model.mission_details.MissionId)"
                                        style="width: 30%;border-radius: 20px;border:2px solid #F88634;color: #F88634">
                                            Already Applied &ensp;
                                            <img src="~/images/Assets/right-arrow.png" alt="">
                                        </a>
                                        foreach (var app in Model.missionApplications)
                                        {
                                            var data = Model.missionApplications.Where(x => x.MissionId == @Model.mission_details.MissionId && x.UserId == Convert.ToInt32(uid)).Select(x => x.MissionApplicationId).FirstOrDefault();
                                            if (data == app.MissionApplicationId)
                                            {
                                                if(app.ApprovalStatus == "Approved")
                                                {
                                                    <p class="text-success" style="font-size:20px">Your Status is Approved</p>
                                                }
                                                else if(app.ApprovalStatus == "Rejected")
                                                {
                                                    <p class="text-danger" style="font-size:20px">Your Status is Rejected</p>
                                                }
                                                else
                                                {
                                                    <p class="text-warning" style="font-size:20px">Your Status is Pending</p>
                                                }
                                                
                                            }
                                        }
                                    }
                                }
                                else
                                {
                                <button type="button" class="btn buttonColor" id="login"
                                    style="width: 30%;border-radius: 20px;border:2px solid #F88634;color: #F88634">
                                    Apply
                                    &ensp;<img src=".\..\images\Assets\right-arrow.png" alt="">
                                </button>
                                }
                            }
                            
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row ">
            <div class="col-lg-8 mt-5">
                <ul class="nav nav-tabs mb-3" id="myTab0" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active mission" id="home-tab0" data-bs-toggle="tab"
                                data-bs-target="#home0" type="button" role="tab" aria-controls="home" aria-selected="true"
                                style="color:rgb(30, 29, 29)">
                            Mission
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="profile-tab0" data-bs-toggle="tab" data-bs-target="#profile0"
                                type="button" role="tab" aria-controls="profile" aria-selected="false"
                                style="color:rgb(30, 29, 29)">
                            Organization
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="contact-tab0" data-bs-toggle="tab" data-bs-target="#contact0"
                                type="button" role="tab" aria-controls="contact" aria-selected="false"
                                style="color:rgb(30, 29, 29)">
                            Comments
                        </button>
                    </li>
                </ul>
                <div class="tab-content" id="myTabContent0">
                    <div class="tab-pane fade show active" id="home0" role="tabpanel" aria-labelledby="home-tab0">
                        <div class="intro mt-4 mb-3">
                            <h4>Introduction</h4>
                        </div>
                        <div class="text">
                            <p>
                                @Model.mission_details.ShortDescription <br />
                                quibusdam obcaecati mollitia eos aliquid earum delectus neque quaerat ratione dolore
                                iusto unde!
                                Deserunt quibusdam obcaecati mollitia eos aliquid earum delectus neque
                            </p>
                            <p>
                                Lorem ipsum dolor, sit amet consectetur adipisicing elit. Deserunt, omnis ducimus,
                                dolorem quibusdam obcaecati mollitia eos aliquid earum delectus neque quaerat ratione dolore
                                iusto unde! Deserunt

                            </p>
                            <p>
                                Lorem ipsum dolor, sit amet consectetur adipisicing elit. Deserunt, omnis ducimus,
                                dolorem quibusdam obcaecati mollitia eos aliquid earum delectus neque quaerat ratione dolore
                                iusto unde! Deserunt Lorem ipsum dolor sit amet consectetur adipisicing elit. Veniam maxime nam
                                vitae. Sit nobis repellendus praesentium dolor, fuga ipsum! Veritatis numquam fugiat nam aspernatur
                                consectetur amet non. Corporis, asperiores harum.
                            </p>
                        </div>
                        <div class="Challenge mt-4 mb-3">
                            <h4>Challenge</h4>
                        </div>
                        <div class="text">
                            <p>
                                Lorem ipsum dolor, sit amet consectetur adipisicing elit. Deserunt, omnis ducimus,
                                dolorem quibusdam obcaecati mollitia eos aliquid earum delectus neque quaerat ratione dolore
                                iusto unde! Deserunt

                            </p>
                            <p>
                                Lorem ipsum dolor, sit amet consectetur adipisicing elit. Deserunt, omnis ducimus,
                                dolorem
                                quibusdam obcaecati mollitia eos aliquid earum delectus neque quaerat ratione dolore
                                iusto unde!
                                Deserunt
                            </p>
                            <p>
                                Lorem ipsum dolor, sit amet consectetur adipisicing elit. Deserunt, omnis ducimus,
                                dolorem
                                quibusdam obcaecati mollitia eos aliquid earum delectus neque quaerat ratione dolore
                                iusto unde!
                                Deserunt Lorem ipsum dolor sit amet consectetur adipisicing elit. Veniam maxime nam
                                vitae. Sit
                                nobis repellendus praesentium dolor, fuga ipsum! Veritatis numquam fugiat nam aspernatur
                                consectetur amet non. Corporis, asperiores harum.
                            </p>
                        </div>
                        <div class="Document mt-4 mb-3">
                            <h4>Document</h4>
                        </div>
                        <div class="d-flex">
                            @*documents in mission*@

                            @foreach (var document in Model.Documents)
                            {
                                if (document.MissionId == Model.mission_details.MissionId)
                                {
                                    if (@document.DocumentType == "png")
                                    {
                                        <div class="pdf ms-3">
                                            <a href="@document.DocumentPath" style="text-decoration: none;color:gray" download> <img src="~/images/Assets/xlsx.png" alt="">&ensp;@document.DocumentName</a>
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="pdf ms-3">
                                            <a href="@document.DocumentPath" style="text-decoration: none;color:gray" download> <img src="~/images/Assets/doc.png" alt="">&ensp;@document.DocumentName</a>
                                        </div>
                                    }
                                }

                            }
                        </div>
                    </div>
                    <div class="tab-pane fade mt-5" id="profile0" role="tabpanel" aria-labelledby="profile-tab0">
                        <p>@Model.mission_details.OrganizationDetail</p>
                    </div>
                    <div class="tab-pane fade" id="contact0" role="tabpanel" aria-labelledby="contact-tab0">
                        <textarea name="comments" id="comment" cols="110" rows="4"
                                  placeholder="Enter your comments">
                        </textarea>
                            @{
                                var currentDate5 = DateTime.Now;
                                if (currentDate5 < @Model.mission_details.EndDate)
                                {
                                    <div class="row mt-4">
                                        <div class="col-lg-12">
                                            <a class="btn login buttonColor" onclick="post()"
                                            style="width: 25%;border-radius: 20px;border:2px solid #F88634;color: #F88634">
                                                Post Comments
                                                &ensp;<img src="~/images/Assets/right-arrow.png" alt="">
                                            </a>
                                        </div>
                                    </div>
                                }
                                else
                                {
                                    <div class="row mt-4">
                                        <div class="col-lg-12">
                                            <button type="button" class="btn login"
                                                style="width: 25%;border-radius: 20px;border:2px solid #F88634;color: #F88634">
                                                Post Comments
                                                &ensp;<img src="~/images/Assets/right-arrow.png" alt="">
                                            </button>
                                        </div>
                                    </div>
                                }
                            }
                       
                        
                        @*comments*@
                        <div id="load">
                            @foreach (var comment in Model.comments.OrderByDescending(x => x.CreatedAt))
                            {
                                <div class="row mt-3 card shadow scroll" style="color:gray;font-size:14px">
                                    <div class="card-body d-flex">
                                        <div class="col-lg-2">
                                            <img src="@Model.Users.Where(x=>x.UserId == comment.UserId).Select(x=>x.Avatar).FirstOrDefault()" alt=""
                                             style="border-radius:50%;height:70%;width:70%">
                                        </div>
                                        <div class="col-lg-10">
                                            @{
                                                var u = comment.UserId;
                                                var firstName = Model.Users.Where(x => x.UserId == u).Select(x => x.FirstName).FirstOrDefault();
                                                var lastName = Model.Users.Where(x => x.UserId == u).Select(x => x.LastName).FirstOrDefault();
                                                <p>@firstName @lastName</p>
                                            }
                                            <p class="text-muted">@comment.CreatedAt</p>
                                            <p>@comment.Comments</p>
                                        </div>
                                    </div>
                                </div>
                            }
                        </div>
                    </div>


                </div>
            </div>
            <div class="col-lg-4">
                <div class="information mt-5">
                    <div class="mb-3">
                        <h4>Information</h4>
                        <hr>
                    </div>
                    <div class="row">
                        <div class="col-lg-2">
                            <p>Skills</p>
                        </div>
                        <div class="col-lg-9">
                            <p>Cool, Easy Doing , Math , Computer</p>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-lg-2">
                            <p>Days</p>
                        </div>
                        <div class="col-lg-9">
                            <p>Weekend Only</p>
                        </div>
                    </div>
                    <hr>
                    @*avarage rating*@
                    <div class="row">
                        <div class="col-lg-2">
                            <p>Rating</p>
                        </div>
                        <div class="col-lg-9">
                            @for (int i = 0; i < Model.AvarageOfRating; i++)
                            {
                                <span>
                                    <img src="~/Assets/selected-star.png" class="mt-1" alt="">
                                </span>
                            }
                            @for (int i = Model.AvarageOfRating; i < 5; i++)
                            {
                                <span>
                                    <img src="~/Assets/star.png" class="mt-1" alt="">
                                </span>
                            }
                            <span>(by @Model.NumberOfVolunteers volunteers)</span>
                        </div>
                    </div>
                </div>
                <div class="recent mt-5">
                    <div class="  mb-3">
                        <h4>Recent Volunteers</h4>
                        <hr>
                    </div>
                    @*Images of volunteer*@
                    <div class="d-flex justify-content-evenly flex-wrap">
                        @{
                            @foreach (var recentVolunteer in @Model.missionApplications.Where(x => x.MissionId == Model.mission_details.MissionId))
                            {
                                <div class="col-lg-4">
                                    <div class="text-center ">
                                        <img src="@Model.Users.Where(x=>x.UserId == recentVolunteer.UserId).Select(x=>x.Avatar).FirstOrDefault()"
                                         class="volImg" alt="" style="border-radius:50%;height:60%;width:60%">
                                        <p style="font-size: 13px;">
                                            @{
                                                var uId = recentVolunteer.UserId;
                                                var fName = Model.Users.Where(x => x.UserId == uId).Select(x => x.FirstName).FirstOrDefault();
                                                var lName = Model.Users.Where(x => x.UserId == uId).Select(x => x.LastName).FirstOrDefault();
                                            <p>@fName  @lName</p>
                                            }
                                        </p>
                                    </div>
                                </div>
                            }
                        }
                        @*pagination*@
                          <div class="d-flex justify-content-center">
                            <cs-pager cs-paging-pagenumber=@Model.currentPage
                                        cs-paging-totalitems=@Model.totalrecord
                                        cs-paging-pagesize="6"
                                        cs-pagenumber-param="pageIndex"
                                        asp-controller="Home"
                                        asp-action="Volunteer"
                                        cs-pager-li-current-class="page-item active"
                                        cs-pager-li-other-class="page-item"
                                        cs-pager-li-non-active-class="page-item disabled"
                                        cs-pager-link-current-class="page-link"
                                        cs-pager-link-other-class="page-link">
                            </cs-pager>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <hr>
    <div class="container grid-container">
            @*  <form asp-controller="Home" asp-action="Platform">*@
            <div class="row">

                @foreach (var item in Model.RelatedMissions)
                {
                    if (@item.MissionType == "Goal" && @item.Status != "In-active")
                    {
                        <div class="col-12 col-md-6 col-lg-4 card">

                            <div class="position-relative imageWidth">
                              @* <img src="@Model.MissionMedia.Where(media => media.MissionId == item.MissionId).Select(media => media.MediaPath).FirstOrDefault()"
                                        class="card-img-top image img2" alt="...">*@
                                        <img src="~/Assets/Grow-Trees-On-the-path-to-environment-sustainability.png"
                                        class="card-img-top image img2" alt="...">
                               
                                <div class="btn text" id="overlap">@item.Theme.Title</div>
                                @*Mission close and active status button*@
                                @if (User.Identity.IsAuthenticated)
                                {
                                    var currentDate = DateTime.Now;
                                    if (currentDate > item.EndDate)
                                    {
                                        <div class="position-absolute py-1 px-4 rounded-end" style="top: 1rem;background-color: red; color:white;">
                                            Closed
                                        </div>
                                    }
                                    else if (Model.missionApplications.Where(x => x.MissionId == item.MissionId && x.UserId == long.Parse(uid)).Count() == 1)
                                    {
                                        <div class="position-absolute py-1 px-4 rounded-end" style="top: 1rem;background-color: green; color:white;">
                                            Applied
                                        </div>
                                    }
                                    else if (currentDate < item.EndDate)
                                    {
                                        <div class="position-absolute py-1 px-4 rounded-end" style="top: 1rem;background-color: #FF6600; color:white;">
                                            Ongoing Mission
                                        </div>
                                    }
                                }
                                <div class="position-absolute location px-2 py-1">
                                    <img src="~/images/Assets/pin.png" alt="">
                                    @item.City.Name
                                </div>
                                @*add to fav*@
                              
                                 @if (uid != null)
                                { 
                                    var Date = DateTime.Now;
                                    if (Date < item.EndDate)
                                    {
                                        //@if (Model.FavoriteMissions.Any(x => x.UserId == Convert.ToInt32(uid) && x.MissionId == Model.mission_details.MissionId))
                                        @if (Model.FavoriteMissions.Where(x => x.UserId == Convert.ToInt32(uid) &&
                                        x.MissionId == Model.mission_details.MissionId).Count() == 1)
                                        {
                                            <button class="position-absolute c1-heart  heart  added" onclick="addFavourite(@item.MissionId);">
                                                <img src="~/Assets/favorite.jpg" alt="" class="" style="width: 30px;height: 30px;">
                                            </button>
                                        }
                                        else
                                        {
                                            <button class="position-absolute c1-heart heart  added" onclick=" addFavourite(@item.MissionId);">
                                                <img src="~/Assets/heart.png" alt="" class="" style="width: 24px; height: 23px;">
                                            </button>
                                        }

                                    }
                                    else
                                    {
                                        <button class="position-absolute c1-heart heart  added" onclick="closeMission();">
                                            <img src="~/Assets/heart.png" alt="" class=" " style="width: 24px; height: 23px;">
                                        </button>
                                    }
                                }
                                else
                                {
                                    <button class="position-absolute c1-heart heart  added" onclick="notloggedin();">
                                        <img src="~/Assets/heart.png" alt="" class=" " style="width: 24px; height: 23px;">
                                    </button>
                                }

                                @if (User.Identity.IsAuthenticated)
                                {
                                    var Date2 = DateTime.Now;
                                    if (Date2 < item.EndDate)
                                    {
                                        <div class="btn">
                                            @*recommended*@
                                            <button type="button" class="position-absolute doc px-2 py-1" id="show">
                                                <img src="~/images/Assets/user.png" alt="">
                                            </button>
                                            <dialog class="myDialog">
                                                <ul>
                                                    @foreach (var n in Model.Users)
                                                    {
                                                        if (n.Email != Email)
                                                        {
                                                            <li class="form-check" style="margin-left:-50%">
                                                                <img src="@Model.Users.Where(x=>x.UserId == n.UserId).Select(x=>x.Avatar).FirstOrDefault()" alt=""
                                             style="height:15%;width:15%;">
                                                                <input type="checkbox" value="@n.UserId" id="check">
                                                                <label class="form-check-label" for="to">
                                                                    @n.FirstName &emsp; @n.LastName
                                                                </label>
                                                            </li>
                                                        }
                                                    }
                                                </ul>
                                                <button class="form-control btn btn-outline-primary m-2" onclick="recommend(@item.MissionId)">Send an email</button>
                                                <button class="form-control btn btn-outline-danger hide-dialog m-2" id="hide">Close</button>
                                            </dialog>
                                        </div>

                                    }
                                    else
                                    {
                                        <button class="position-absolute c1-heart heart doc added" onclick="closeMission();">
                                            <img src="~/images/Assets/user.png" alt="">
                                        </button>
                                    }
                                }
                                else
                                {
                                    //<button type="button" class="position-absolute doc px-2 py-1" onclick="notloggedin()">
                                    //	<img src="~/images/Assets/user.png" alt="">
                                    //</button>
                                    <button class="position-absolute c1-heart heart doc added" onclick="notloggedin();">
                                        <img src="~/images/Assets/user.png" alt="">
                                    </button>
                                }

                            </div>

                            <div class="card-body">
                                <h5 class="card-title">
                                    <p style="font-size: 25px;color: rgb(61, 61, 61);">
                                        @item.Title
                                    </p>
                                </h5>
                                <p class="card-text" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;overflow: hidden;">@item.Description</p>
                                <div class="d-flex justify-content-between">
                                    <div>
                                        <p>@item.OrganizationName</p>
                                    </div>
                                    <div>
                                        @{
                                            var numberOFUser = Model.missionRatings.Where(x => x.MissionId == item.MissionId).Select(x => x.Rating);
                                            if (numberOFUser.Count() != 0)
                                            {
                                                var rate_star = Convert.ToInt32(Queryable.Average(numberOFUser.AsQueryable()));
                                                for (int i = 1; i <= 5; i++)
                                                {
                                                    if (i <= rate_star)
                                                    {
                                                        <img src="~/Assets/selected-star.png">
                                                    }
                                                    else
                                                    {
                                                        <img src="~/Assets/star.png">
                                                    }
                                                }
                                            }
                                            else
                                            {
                                                for (int i = 1; i <= 5; i++)
                                                {
                                                    <img src="~/Assets/star.png">
                                                }
                                            }
                                        }
                                    </div>
                                </div>
                                <div class="border-top mt-4">
                                    <div>
                                        <div class="d-flex justify-content-center mt-4">
                                            <div class="star">
                                                <p class="text-center" style="border: 1px solid gray;border-radius:20px;padding:0px 15px 0px 15px ;">
                                                    Plant 10,000 Trees

                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <div class="d-flex">
                                        <div class="col-lg-3 me-2">
                                            <img src="~/images/Assets/Seats-left.png" alt="">
                                        </div>
                                        <div class="col-lg-9">
                                            <p>@item.Availability <br> Seats Left</p>
                                        </div>
                                    </div>

                                    <div class="col-lg-6">
                                        <div class="d-flex">
                                            <div class="col-lg-2">
                                                <img src="~/images/Assets/Achieved.png" alt="">
                                            </div>
                                            <div class="col-lg-10">

                                                @foreach (var goal in Model.goal)
                                                {
                                                    @if(goal.GoalMissionId != null)
                                                    {
                                                        @if (item.MissionId == goal.MissionId)
                                                        {
                                                            <div class="progress">
                                                                @{
                                                                    int percentComplete = (int)Math.Round((double)(100 * @goal.GoalValue) / @goal.Aimed);
                                                                }

                                                                <div class="progress-bar" role="progressbar" style="width: @percentComplete%;background-color: #F88634;color:#F88634" aria-valuenow=@goal.GoalValue
                                                                aria-valuemin="0" aria-valuemax="100"></div>
                                                            </div>
                                                            <p> @goal.GoalValue Achieved </p>
                                                        }

                                                    }
                                                    else
                                                    {
                                                        
                                                    }

                                                }


                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <hr>
                                <div class="row text-center">
                                    <div class="col-lg-12">
                                        @if (uid != null)
                                        {
                                            <a asp-controller="Home" asp-action="Volunteer" class="btn buttonColor" id="login" asp-route-id="@item.MissionId"
                           style="width:auto;border-radius: 20px;border:2px solid #F88634;color: #F88634;">
                                                View Details
                                                &ensp;<img src="~/images/Assets/right-arrow.png" alt="">
                                            </a>
                                        }
                                        else
                                        {
                                            <a href="#" class="btn buttonColor" id="login" onclick="notloggedin()"
                               style="width:auto;border-radius: 20px;border:2px solid #F88634;color: #F88634;">
                                                View Details
                                                &ensp;<img src="~/images/Assets/right-arrow.png" alt="">
                                            </a>
                                        }

                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                    else if (@item.MissionType == "Time" && @item.Status != "In-active")
                    {
                        <div class="col-12 col-md-6 col-lg-4 card">
                            <div class="position-relative imageWidth">
                              @*  <img src="~/Assets/CSR-initiative-stands-for-Coffee--and-Farmer-Equity.png"
                                 class="card-img-top image" alt="...">*@
                                 @*<img src="@Model.MissionMedia.Where(media => media.MissionId == item.MissionId).Select(media => media.MediaPath).FirstOrDefault()"
                                        class="card-img-top image img2" alt="...">*@
                                        <img src="~/Assets/Education-Supplies-for-Every--Pair-of-Shoes-Sold.png"
                                        class="card-img-top image img2" alt="...">
                                <button class="btn text" id="overlap">@item.ShortDescription</button>
                                @*Mission close and active status button*@
                                @if (User.Identity.IsAuthenticated)
                                {
                                    var currentDate = DateTime.Now;
                                    if (currentDate > item.EndDate)
                                    {
                                        <div class="position-absolute py-1 px-4 rounded-end" style="top: 1rem;background-color: red; color:white;">
                                            Closed
                                        </div>
                                    }
                                    else if (Model.missionApplications.Where(x => x.MissionId == item.MissionId && x.UserId == long.Parse(uid)).Count() == 1)
                                    {
                                        <div class="position-absolute py-1 px-4 rounded-end" style="top: 1rem;background-color: green; color:white;">
                                            Applied
                                        </div>
                                    }
                                    else if (currentDate < item.EndDate)
                                    {
                                        <div class="position-absolute py-1 px-4 rounded-end" style="top: 1rem;background-color: #FF6600; color:white;">
                                            Ongoing Mission
                                        </div>
                                    }
                                }
                                <div class="position-absolute location px-2 py-1">
                                    <img src="~/images/Assets/pin.png" alt="">
                                    @item.City.Name
                                </div>

                                @if (uid != null)
                                {

                                     var currentDate8 = DateTime.Now;
                                    if (currentDate8 < item.EndDate)
                                    {
                                        //@if (Model.FavoriteMissions.Where(x => x.UserId == Convert.ToInt32(uid) &&
                                        //x.MissionId == Model.mission_details.MissionId).Count() == 1)
                                        @if (Model.FavoriteMissions.Any(x => x.UserId == Convert.ToInt32(uid) && x.MissionId == Model.mission_details.MissionId))

                                        {
                                            <button class="position-absolute c1-heart  heart  added" onclick="addFavourite(@item.MissionId);">
                                                <img src="~/Assets/favorite.jpg" alt="" class="" style="width: 30px;height: 30px;">
                                            </button>
                                        }
                                        else
                                        {
                                            <button class="position-absolute c1-heart heart added" onclick=" addFavourite(@item.MissionId);">
                                                <img src="~/Assets/heart.png" alt="" class="" style="width: 24px; height: 23px;">
                                            </button>
                                        }

                                    }
                                    else
                                    {
                                        <button class="position-absolute c1-heart heart favorite added" onclick="closeMission();">
                                            <img src="~/Assets/heart.png" alt="" class=" " style="width: 24px; height: 23px;">
                                        </button>
                                    }
                                }
                                else
                                {
                                    <button class="position-absolute c1-heart heart favorite added" onclick="notloggedin();">
                                        <img src="~/Assets/heart.png" alt="" class=" " style="width: 24px; height: 23px;">
                                    </button>
                                }
                                @if (User.Identity.IsAuthenticated)
                                {
                                     var currentDate9 = DateTime.Now;
                                    if (currentDate9 < item.EndDate)
                                    {
                                        <div class="btn">
                                            @*recommended*@
                                            <button type="button" class="position-absolute show-dialog doc px-2 py-1" id="show">
                                                <img src="~/images/Assets/user.png" alt="">
                                            </button>
                                            <dialog id="myDialog">
                                                <ul>
                                                    @foreach (var n in Model.Users)
                                                    {
                                                        if (n.Email != Email)
                                                        {
                                                            <li class="form-check">
                                                                <img src="@Model.Users.Where(x=>x.UserId == n.UserId).Select(x=>x.Avatar).FirstOrDefault()" alt=""
                                                                    style="height:20%;width:20%;">
                                                                <input type="checkbox" value="@n.UserId" id="check">
                                                                <label class="form-check-label" for="to">
                                                                    @n.FirstName &emsp; @n.LastName
                                                                </label>
                                                            </li>
                                                        }
                                                    }
                                                </ul>
                                                <button class="form-control btn btn-outline-primary m-2" onclick="recommend(@item.MissionId)">Send an email</button>
                                                <button class="form-control btn btn-outline-danger m-2" id="hide">Close</button>
                                            </dialog>
                                        </div>

                                    }
                                    else
                                    {
                                        <button type="button" class="position-absolute doc px-2 py-1" onclick="closeMission();">
                                            <img src="~/images/Assets/user.png" alt="">
                                        </button>
                                    }
                                }
                                else
                                {
                                    <button type="button" class="position-absolute doc px-2 py-1" onclick="notloggedin();">
                                        <img src="~/images/Assets/user.png" alt="">
                                    </button>
                                }


                                <!-- <p class="ps-1 pe-1" style="border-radius: 20px; background-color: white;">Environment
                                </p> -->
                        </div>


                            <div class="card-body">
                                <h5 class="card-title">
                                    <p style="font-size: 25px;color: rgb(61, 61, 61);">
                                        @item.Title
                                    </p>
                                </h5>
                                <p class="card-text" style="display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;overflow: hidden;">@item.Description </p>

                                <div class="d-flex justify-content-between">
                                    <div>
                                        <p>@item.OrganizationName</p>
                                    </div>
                                    <div>
                                        @{

                                            var numberOFUser = Model.missionRatings.Where(x => x.MissionId == item.MissionId).Select(x => x.Rating);
                                            if (numberOFUser.Count() != 0)
                                            {
                                                var rate_star = Convert.ToInt32(Queryable.Average(numberOFUser.AsQueryable()));
                                                for (int i = 1; i <= 5; i++)
                                                {
                                                    if (i <= rate_star)
                                                    {
                                                        <img src="~/Assets/selected-star.png">
                                                    }
                                                    else
                                                    {
                                                        <img src="~/Assets/star.png">
                                                    }
                                                }
                                            }
                                            else
                                            {
                                                for (int i = 1; i <= 5; i++)
                                                {
                                                    <img src="~/Assets/star.png">
                                                }
                                            }
                                        }

                                    </div>
                                </div>
                                <div class="border-top mt-4">
                                    <div>
                                        <div class="d-flex justify-content-center mt-4">
                                            <div class="star">
                                                <p class="text-center" style="border: 1px solid gray;border-radius:20px;padding:0px 15px 0px 15px ;">
                                                    From
                                                    @item.StartDate.ToShortDateString() until  @item.EndDate.ToShortDateString()
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between">
                                    <div class="d-flex">

                                        <div class="d-flex">
                                            <div class="col-lg-3 me-2">
                                                <img src="~/images/Assets/Seats-left.png" alt="">
                                            </div>
                                            <div class="col-lg-9">
                                                <p>@item.Availability <br> Seats Left</p>
                                            </div>
                                        </div>

                                    </div>
                                    <div class="deadline ">
                                        <div class="d-flex">
                                            <div>
                                                <img src="~/images/Assets/Deadline.png" alt="">
                                            </div>
                                            <div>
                                                <p>@item.EndDate.ToShortDateString() <br> Deadline</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <hr>
                                <div class="row text-center">
                                    <div class="col-lg-12">

                                        @if (uid != null)
                                        {
                                            <a asp-controller="Home" asp-action="Volunteer" class="btn buttonColor" id="login" asp-route-id="@item.MissionId"
                           style="width:auto;border-radius: 20px;border:2px solid #F88634;color: #F88634;">
                                                View Details
                                                &ensp;<img src="~/images/Assets/right-arrow.png" alt="">
                                            </a>
                                        }
                                        else
                                        {
                                            <a href="#" class="btn buttonColor" id="login" onclick="notloggedin()"
                               style="width:auto;border-radius: 20px;border:2px solid #F88634;color: #F88634;">
                                                View Details
                                                &ensp;<img src="~/images/Assets/right-arrow.png" alt="">
                                            </a>
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                }
            </div>
            @*</form>*@
        </div>
    <hr>
    <partial name="_footer" />


    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
            integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
            crossorigin="anonymous"></script>
    <script src="~/js/Volunteer.js"></script>
    @*    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>*@

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

    </div>

    <script type="text/javascript">
        //rating
        function CRateOut(rating){
            for (var i=1; i<=rating;i++)
            {
                $("#span"+i).attr('src',"/Assets/star.png");
            }
        }
        function CRateOver(rating){
            for (var i=1; i<=rating;i++)
            {
                $("#span"+i).attr('src',"/Assets/selected-star.png");
            }
        }
        function CRateClick(rating){
            $("#lblRating").val(rating);
            for (var i=1; i<rating+1;i++)
            {
                $("#span"+i).attr('src',"/Assets/selected-star.png");
            }
            for (var i=rating+1; i<=5;i++)
            {
                $("#span"+i).attr('src',"/Assets/star.png");
            }
            sendrate(rating);
        }
        function CRateSelected(){
            var rating=$("#lblRating").val();
            for (var i=1; i<=rating;i++)
            {
                $("#span"+i).attr('src',"/Assets/selected-star.png");
            }
        }
        function sendrate(rating){
            $.ajax({
                url:"/Home/updateandaddrate",
                type:"POST",
                data:{
                    missionid:@Model.mission_details.MissionId,
                    rating:rating,
                    Email:"@Email"
                },
                success:function(result){
                    console.log(rating);
                    console.log("rating is updated succesfully");
                    location.reload();
                }
            });
        }

        $(document).ready(function(){
            $("#lblRating").val(@Model.UserRate);
            CRateSelected();
        })
    </script>
    <script>
         //fav
        function fav(id){

            $.ajax({
                url:"/Home/AddToFav",
                type:"POST",
                data:{
                    "missionid":id,
                    "email":"@Email",
                },
                success : function(){
                    location.reload();
                }
            });

        }

    </script>
    <script>
        //comments
           function post(){
               var c =document.getElementById("comment").value;
               $.ajax({
                   type:"POST",
                   url:"/Home/PostComment",
                   data:{
                       missionid:@Model.mission_details.MissionId,
                       comment: c,
                       email:"@Email",
                   },
                   success: function(result){
                       $('#load').html($(result).find('#load').html());
                       $('#comment').val('');
                   }
               });
           }
    </script>
    <script>
        //Apply button
        function applyMission(id){
            $.ajax({
                type:"POST",
                url:"/Home/applyForMission",
                data:{
                    "id":id,
                },
                success : function(){
                    location.reload();
                }
            });
        }

        //Recommenrded
		var dialog = document.querySelector('.myDialog');
		document.querySelector('.show-dialog').onclick = function () { dialog.showModal(); };
		document.querySelector('.hide-dialog').onclick = function () { dialog.close(); };

		function recommend(id) {
		  var to = [];
		 // $(".check:checked").each(function () {
			//to.push($(this).val());
		 // });
		  $("input:checkbox.check:checked").each(function () {
				to.push($(this).val());
			});
		  $.ajax({
			url: "/Home/Recommend",
			type: "POST",
			data: {
			  "missionid": id,
			  to: to
			}
		  });
		}

        //fav mission for related mission
         function addFavourite(missionId) {
        console.log(missionId);
        $.ajax({
            url: "/Home/FavouriteMission",
            type: "POST",
            data: {
                mId: missionId
            },
            success: function (result) {
                console.log(result);
                location.reload();
                //$('.xyz').html($(result).find('.xyz').html());
            }
        });
    }
    //sweet alert for close mission
          function closeMission() {
        // trigger the alert message using Swal.fires
            Swal.fire({
                icon: 'error',
                showCloseButton: true,
                title: 'This Mission is Close',
                showConfirmButton: false,
                
            });
        //console.log(footer);
        };
    </script>


</body>

</html>