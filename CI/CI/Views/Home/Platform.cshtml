@{
    ViewData["Title"] = " Mission Page";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@model GeneralViewModel
@using System.Security.Claims;
@{
    var identity = User.Identity as ClaimsIdentity;
    var name = identity?.FindFirst(ClaimTypes.Name)?.Value;
    var surname = identity?.FindFirst(ClaimTypes.Surname)?.Value;
    var Email = identity?.FindFirst(ClaimTypes.Email)?.Value;
    var uid = identity?.FindFirst(ClaimTypes.Sid)?.Value;
}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="~/css/platform.css">
    <link rel="stylesheet" href="~s/CSS/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>

<body>

    <partial name="_navbar" />
    <div class="container">

        @{
            var count = @Model.Missions.Count();
            if (count > 0)
            {
          
                <div class="row" id="grid">
                    <div class="col-lg-8 col-md-7 col-sm-6  mt-4">
                        <p class="explore">Explore <big>@Model.Missions.Count() Mission</big> </p>
                    </div>
                    <div class="col-lg-2 col-md-3 col-sm-4 mt-4 d-none d-lg-block">

                        <a class=" dropdown ps-3" type="button" data-bs-toggle="dropdown"
                       style="border: 1px solid gray; color:black;text-decoration: none;width: 180px;">
                            Sort by &emsp;&ensp;<img src="~/images/Assets/drop-down.png">
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" asp-controller="Home" asp-action="Platform" asp-route-id="1">Newest</a></li>
                            <li><a class="dropdown-item" asp-controller="Home" asp-action="Platform" asp-route-id="2">Oldest</a></li>
                            <li><a class="dropdown-item" asp-controller="Home" asp-action="Platform" asp-route-id="3">Highest Available seats</a></li>
                            <li><a class="dropdown-item" asp-controller="Home" asp-action="Platform" asp-route-id="4">Lowest Available seats</a></li>
                            <li><a class="dropdown-item" asp-controller="Home" asp-action="Platform" asp-route-id="5">Goal Theme</a></li>
                            <li><a class="dropdown-item" asp-controller="Home" asp-action="Platform" asp-route-id="6">Time Theme</a></li>

                        </ul>

                    </div>
                    <div class="col-lg-1 col-md-2 col-sm-1 mt-3 text-end d-none d-lg-block">

                        &ensp;<a href="#" class="btn btn-grid">
                            <img src="~/images/Assets/grid.png" alt=""
                         style="padding: 7px;background-color: rgb(212, 212, 212);border-radius: 50%;">
                        </a>
                    </div>
                    <div class="col-lg-1 col-md-2 col-sm-1 mt-3 text-center d-none d-lg-block">
                        <a href="#" class="btn btn-list"><img src="~/images/Assets/list.png" alt=""></a>
                    </div>

                </div>


                <div class="container grid-container">
                    <form asp-controller="Home" asp-action="Platform">
                        <div class="row">

                            @foreach (var item in Model.Missions)
                            {
                                if (@item.MissionType == "Goal")
                                {
                                    <div class="col-12 col-md-6 col-lg-4">
                                        <div class="card">
                                            <div class="position-relative">
                                                <img src="~/images/Assets/Animal-welfare-_-save-birds-campaign.png"
                                                class="card-img-top image img2" alt="...">
                                                <button class="btn text" id="overlap">@item.Theme.Title</button>
                                                <div class="position-absolute location px-2 py-1">
                                                    <img src="~/images/Assets/pin.png" alt="">
                                                    @item.City.Name
                                                </div>
                                                <div class="position-absolute heart px-2 py-1">
                                                    <img src="~/images/Assets/heart.png" alt="">
                                                </div>
                                                <div class="position-absolute doc px-2 py-1"style="width:70px;height:50px">
                                                @if(User.Identity.IsAuthenticated)
                                                {
                                                    <div class="btn">
                                                        @*recommended*@
                                                        <button id="show" type="button" class="Recommend"style="background:none;height:10px;width:10px"><img src="~/Assets/add1.png" />
                                                        </button>
                                                        <dialog id="myDialog">
                                                            <ul>
                                                                @foreach (var n in Model.Users)
                                                                {
                                                                    if (n.Email != Email)
                                                                    {
                                                                        <li class="form-check">
                                                                            <input type="checkbox" value="@n.UserId" id="check">
                                                                            <label class="form-check-label" for="to">
                                                                                @n.FirstName &emsp; @n.LastName
                                                                            </label>
                                                                        </li>
                                                                    }
                                                                }
                                                            </ul>
                                                            <button class="form-control btn btn-outline-primary m-2" onclick="recommend(@item.MissionId)">Send an email</button>
                                                            <button class="form-control btn btn-outline-danger m-2" id="hide">Close</button>
                                                        </dialog>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <button type="button" class="Recommend"style="background:none;height:10px;width:10px"><img src="~/Assets/add1.png" />
                                                        </button>
                                                    }
                                                </div>
                                            </div>

                                            <div class="card-body">
                                                <h5 class="card-title">
                                                    <p style="font-size: 25px;color: rgb(61, 61, 61);">
                                                        @item.Title
                                                    </p>
                                                </h5>
                                                <p class="card-text">@item.Description</p>
                                                <div class="d-flex justify-content-between">
                                                    <div>
                                                        <p>@item.OrganizationName</p>
                                                    </div>
                                                    <div>
                                                        @{
                                                            var numberOFUser = Model.missionRatings.Where(x => x.MissionId == item.MissionId).Select(x => x.Rating);
                                                            if(numberOFUser.Count() != 0)
                                                            {
                                                                var rate_star = Convert.ToInt32(Queryable.Average(numberOFUser.AsQueryable()));
                                                                for(int i = 1; i <= 5; i++)
                                                                {
                                                                    if (i <= rate_star)
                                                                    {
                                                                        <img src="~/Assets/selected-star.png">
                                                                    }
                                                                    else
                                                                    {
                                                                        <img src="~/Assets/star.png">
                                                                    }
                                                                }
                                                            }
                                                            else
                                                            {
                                                                for(int i = 1; i <= 5; i++)
                                                                {
                                                                    <img src="~/Assets/star.png">
                                                                }
                                                            }
                                                        }
                                                    </div>
                                                </div>
                                                <div class="border-top mt-4">
                                                    <div>
                                                        <div class="d-flex justify-content-center mt-4">
                                                            <div class="star">
                                                                <p class="text-center" style="border: 1px solid gray;border-radius:20px;padding:0px 15px 0px 15px ;">
                                                                    Plant 10,000 Trees

                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="d-flex justify-content-between">
                                                    <div class="col-lg-5">

                                                        <div class="row">
                                                            <div class="col-lg-2">
                                                                <img src="~/images/Assets/Seats-left.png" alt="">
                                                            </div>
                                                            <div class="col-lg-9">
                                                                <p>@item.Availability <br> Seats Left</p>
                                                            </div>
                                                        </div>

                                                    </div>
                                                   
                                                    <div class="col-lg-7">
                                                        <div class="d-flex">

                                                            <div class="col-lg-2">
                                                                <img src="~/images/Assets/Achieved.png" alt="">
                                                            </div>
                                                            <div class="col-lg-10">
                                                                <div class="progress">
                                                                    <div class="progress-bar" role="progressbar"
                                                             style="width: 75%;background-color: #F88634;" aria-valuenow="75"
                                                             aria-valuemin="0" aria-valuemax="100"></div>
                                                                </div> <br> 8000 Achieved
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>
                                                <hr>
                                                <div class="row text-center">
                                                    <div class="col-lg-12">

                                                        <button type="submit" asp-controller="Home" asp-action="Volunteer" class="btn" id="login" asp-route-id="@item.MissionId"
                                                style="width: 40%;border-radius: 20px;border:2px solid #F88634;color: #F88634;">
                                                            View Details
                                                            &ensp;<img src="~/images/Assets/right-arrow.png" alt="">
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                }
                                else if (@item.MissionType == "Time")
                                {
                                    <div class="col-12 col-md-6 col-lg-4">
                                        <div class="card">
                                            <div class="position-relative">
                                                <img src="~/images/Assets/Grow-Trees-On-the-path-to-environment-sustainability.png"
                                     class="card-img-top image" alt="...">
                                                <button class="btn text" id="overlap">@item.ShortDescription</button>
                                                <div class="position-absolute location px-2 py-1">
                                                    <img src="~/images/Assets/pin.png" alt="">
                                                    @item.City.Name
                                                </div>
                                                <div class="position-absolute heart px-2 py-1">
                                                    <img src="~/images/Assets/heart.png" alt="">
                                                </div>
                                                 <div class="position-absolute doc px-2 py-1"style="width:70px;height:50px">
                                                    <div class="btn">
                                                        @*recommended*@
                                                        <button id="show" type="button" class="Recommend"style="background:none;height:10px;width:10px"><img src="~/Assets/add1.png" />
                                                        </button>
                                                        <dialog id="myDialog">
                                                            <ul>
                                                                @foreach (var n in Model.Users)
                                                                {
                                                                    if (n.Email != Email)
                                                                    {
                                                                        <li class="form-check">
                                                                            <input type="checkbox" value="@n.UserId" id="check">
                                                                            <label class="form-check-label" for="to">
                                                                                @n.FirstName &emsp; @n.LastName
                                                                            </label>
                                                                        </li>
                                                                    }
                                                                }
                                                            </ul>
                                                            <button class="form-control btn btn-outline-primary m-2" onclick="recommend(@item.MissionId)">Send an email</button>
                                                            <button class="form-control btn btn-outline-danger m-2" id="hide">Close</button>
                                                        </dialog>
                                                    </div>
                                                </div>
                                                <!-- <p class="ps-1 pe-1" style="border-radius: 20px; background-color: white;">Environment
                                                </p> -->
                                            </div>


                                            <div class="card-body">
                                                <h5 class="card-title">
                                                    <p style="font-size: 25px;color: rgb(61, 61, 61);">
                                                        @item.Title
                                                    </p>
                                                </h5>
                                                <p class="card-text">@item.Description </p>

                                                <div class="d-flex justify-content-between">
                                                    <div>
                                                        <p>@item.OrganizationName</p>
                                                    </div>
                                                    <div>
                                                          @{
                                                   
                                                            var numberOFUser = Model.missionRatings.Where(x => x.MissionId == item.MissionId).Select(x => x.Rating);
                                                            if(numberOFUser.Count() != 0)
                                                            {
                                                                var rate_star = Convert.ToInt32(Queryable.Average(numberOFUser.AsQueryable()));
                                                                for(int i = 1; i <= 5; i++)
                                                                {
                                                                    if (i <= rate_star)
                                                                    {
                                                                        <img src="~/Assets/selected-star.png">
                                                                    }
                                                                    else
                                                                    {
                                                                        <img src="~/Assets/star.png">
                                                                    }
                                                                }
                                                            }
                                                            else
                                                            {
                                                                for(int i = 1; i <= 5; i++)
                                                                {
                                                                    <img src="~/Assets/star-empty.png">
                                                                }
                                                            }
                                                        }
                                                   
                                                    </div>
                                                </div>
                                                <div class="border-top mt-4">
                                                    <div>
                                                        <div class="d-flex justify-content-center mt-4">
                                                            <div class="star">
                                                                <p class="text-center" style="border: 1px solid gray;border-radius:20px;padding:0px 15px 0px 15px ;">
                                                                    From
                                                                    @item.StartDate.Value.ToShortDateString() until  @item.EndDate.Value.ToShortDateString()
                                                                </p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="d-flex justify-content-between">
                                                    <div class="d-flex">

                                                        <div class="d-flex">
                                                            <div class="col-lg-3 me-2">
                                                                <img src="~/images/Assets/Seats-left.png" alt="">
                                                            </div>
                                                            <div class="col-lg-9">
                                                                <p>@item.Availability <br> Seats Left</p>
                                                            </div>
                                                        </div>

                                                    </div>
                                                    <div class="deadline ">
                                                        <div class="d-flex">
                                                            <div>
                                                                <img src="~/images/Assets/Deadline.png" alt="">
                                                            </div>
                                                            <div>
                                                                <p>@item.EndDate.Value.ToShortDateString() <br> Deadline</p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <hr>
                                                <div class="row text-center">
                                                    <div class="col-lg-12">

                                                        <button type="submit" asp-controller="Home" asp-action="Volunteer" class="btn" id="login" asp-route-id="@item.MissionId"
                                                            style="width: 40%;border-radius: 20px;border:2px solid #F88634;color: #F88634">
                                                            View Details
                                                            &ensp;<img src="~/images/Assets/right-arrow.png" alt="">
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                }
                            }
                        </div>
                    </form>
                </div>
            }
            else
            {
                <div class="text-center my-5">
                    <h3>No Mission Found</h3>
                    <button type="submit" asp-controller="Home" asp-action="Volunteer" class="btn" id="login"
                    style="width: 30%;border-radius: 20px;border:2px solid #F88634;color: #F88634">
                        Submit Your Mission
                        &ensp;<img src="~/images/Assets/right-arrow.png" alt="">
                    </button>
                </div>

            }
        }
        <div class="d-flex justify-content-center">
            <cs-pager cs-paging-pagenumber=@Model.currentPage
                      cs-paging-totalitems=@Model.totalrecord
                      cs-paging-pagesize="3"
                      cs-pagenumber-param="pageIndex"
                      asp-controller="Home"
                      asp-action="Platform"
                      cs-pager-li-current-class="page-item active"
                      cs-pager-li-other-class="page-item"
                      cs-pager-li-non-active-class="page-item disabled"
                      cs-pager-link-current-class="page-link"
                      cs-pager-link-other-class="page-link">
            </cs-pager>
        </div>
        
        <hr>
        <div class="copyright">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 col-sm-12">
                        <div class="copyright-menu">
                            <ul>
                                <li>
                                    <a href="#">Privacy Policy</a>
                                </li>
                                <li>
                                    <a href="#">Cookies Policy</a>
                                </li>
                                <li>
                                    <a href="#">Terms of use</a>
                                </li>

                            </ul>
                        </div>
                    </div>
                    <div class="col-md-6 rights">
                        <span> © 2019 optimy.com. All Right Reserved </span>
                    </div>
                    <!-- End Col -->
                    <!-- End col -->
                </div>
                <!-- End Row -->
            </div>
            <!-- End Copyright Container -->
        </div>
    </div>


    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
            integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
            crossorigin="anonymous"></script>
    <script src="~/js/platform.js"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
            integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
            crossorigin="anonymous"></script>
   
    <script>
        //       window.addEventListener("load", () => {
        //      // (A) GET HTML ELEMENTS
        //      var filter = document.getElementById("search-field"), // search box
        //          list = document.querySelectorAll(".card"); // all cards

        //      // (B) ATTACH KEY UP LISTENER TO SEARCH BOX
        //      filter.onkeyup = () => {
        //        // (B1) GET CURRENT SEARCH TERM
        //        let search = filter.value.toLowerCase();

        //        // (B2) LOOP THROUGH LIST ITEMS - ONLY SHOW THOSE THAT MATCH SEARCH
        //        for (let i of list ){
        //            let a = i.getElementsByClassName("card-body")[0]
        //            console.log(a)
        //          let item = a.innerHTML.toLowerCase();
        //          if (item.indexOf(search) == -1) { i.hidden = true; }
        //          else { i.hidden = false; }
        //    }
        //  };
        //});
        //</script>
    <script>
        @*filter by themes , cities , skills*@

        $(document).ready(function () {
        $('input[type=checkbox][id=flexCheckDefault]').change(function () {
        var selectTheme = $('input[type=checkbox][id=flexCheckDefault]:checked').map(function () {
        return $(this).val();

        }).get();
        console.log(selectTheme);
        if (selectTheme.length > 0) {
        $('.card').hide();
        $.each(selectTheme, function (index, value) {
        $('.card:contains("' + value + '")').show();

        });
        } else {
        $('.card').show();
        }
        });
        });
    </script>
    //<script>
    //    $(".ratingStar").hover(function (){

    //        $(".ratingStar").addClass("far").removeClass("fas");
    //        $(this).addClass("fas").removeClass("far");
    //        $(this).prevAll(".ratingStar").addClass("fas").removeClass("far");

    //    })
    //    $(".ratingStar").click(function (){
    //         var starValue = $(this).attr("data-value");
    //         debugger;
    //        $("#ratingsStar").val(starValue);
    //    })

    //</script>



</body>
</html>



